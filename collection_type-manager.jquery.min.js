!function(e){e.fn.collectionManager=function(o,n){return void 0!==(ret=t[o].apply(this,n))?ret:e(this)};var t={isDeleteAllowed:function(){return e(this).data("allowDelete")!==!1},isAddAllowed:function(){return void 0!==e(this).data("prototype")&&e(this).data("allowAdd")!==!1},isDeleteNewAllowed:function(){return e(this).data("allowDeleteNew")!==!1},confirmDelete:function(){return e(this).data("deleteConfirm")===!0},deleteMessage:function(){var t=e(this).data("deleteMessage");return void 0!==t?t:"Are you sure?"},childSelector:function(){return">"+(void 0!==e(this).data("itemSelector")?e(this).data("itemSelector"):"div")},prototypeName:function(){return void 0!==e(this).data("prototypeName")?e(this).data("prototypeName"):"__name__"},insert:function(t){var o=e(this).collectionManager("childSelector"),n=e(this).find(o).last();if(0!==n.length)return void e(t).insertAfter(n);var i=e(this).find(".collection_adder").first();if(0!==i.length)return void e(t).insertBefore(i);t.appendTo(e(this))},addCollectionItem:function(){var t=e.Event("collection.preInsert");if(e(this).trigger(t),!t.isDefaultPrevented()){var o=e(this).data("prototype"),n=e(this).collectionManager("prototypeName"),i=e(this).collectionManager("childSelector"),l=e(this).find(i).length,a=new RegExp(n,"g"),r=new RegExp(n+"label__","g"),o=o.replace(r,l).replace(a,l),c=e(o);e(this).collectionManager("insert",c),e(this).collectionManager("isDeleteNewAllowed")&&e(c).collectionManager("provideDeleteButton"),e(c).collectionManager("updateCollection"),e(this).trigger(e.Event("collection.postInsert",{item:c}))}},deleteCollectionItem:function(t){var o=e.Event("collection.preDelete",{item:t});e(this).trigger(o),o.isDefaultPrevented()||e(this).collectionManager("confirmDelete")&&!confirm(e(this).collectionManager("deleteMessage"))||(e(t).remove(),e(this).trigger(e.Event("collection.postDelete",{item:t})))},newAddButton:function(){var t,o=e(this).data("adderPrototype");return t=void 0!==o?e(o):e("<button/>").attr("type","button").html("add"),t.addClass("collection_adder"),t},newDeleteButton:function(){var t,o=e(this).parent().data("deleterPrototype");return t=void 0!==o?e(o):e("<button/>").attr("type","button").html("delete"),t.addClass("collection_deleter"),t},provideAddButton:function(){if(0==e(this).find("> .collection_adder").length){var t=this;addButton=e(this).collectionManager("newAddButton").appendTo(this).click(function(){e(t).collectionManager("addCollectionItem")})}},provideDeleteButton:function(){if(0==e(this).find("> .collection_deleter").length){var t=this;deleteButton=e(this).collectionManager("newDeleteButton").appendTo(this).click(function(){e(t).parent().collectionManager("deleteCollectionItem",t)})}},updateCollection:function(){e(this).find('[data-prototype], [data-allow-remove="true"]').each(function(){if(e(this).collectionManager("isAddAllowed")&&e(this).collectionManager("provideAddButton"),e(this).collectionManager("isDeleteAllowed")){var t=e(this).collectionManager("childSelector");e(this).find(t).each(function(){e(this).collectionManager("provideDeleteButton")})}})}};e(document).ready(function(){e(this).collectionManager("updateCollection")})}(jQuery);