!function(t){t.fn.collectionManager=function(o,n){return void 0!==(ret=e[o].apply(this,n))?ret:t(this)};var e={isDeleteAllowed:function(){return t(this).data("allowDelete")!==!1},isAddAllowed:function(){return void 0!==t(this).data("prototype")&&t(this).data("allowAdd")!==!1},isDeleteNewAllowed:function(){return t(this).data("allowDeleteNew")!==!1},childSelector:function(){return">"+(void 0!==t(this).data("itemSelector")?t(this).data("itemSelector"):"div")},prototypeName:function(){return void 0!==t(this).data("prototypeName")?t(this).data("prototypeName"):"__name__"},insert:function(e){var o=t(this).collectionManager("childSelector"),n=t(this).find(o).last();if(0!==n.length)return void t(e).insertAfter(n);var i=t(this).find(".collection_adder").first();if(0!==i.length)return void t(e).insertBefore(i);e.appendTo(t(this))},addCollectionItem:function(){var e=t(this).data("prototype"),o=t(this).collectionManager("prototypeName"),n=t(this).collectionManager("childSelector"),i=t(this).find(n).length,l=new RegExp(o,"g"),a=new RegExp(o+"label__","g"),e=e.replace(a,i).replace(l,i),r=t(e);t(this).collectionManager("insert",r),t(this).collectionManager("isDeleteNewAllowed")&&t(r).collectionManager("provideDeleteButton"),t(r).collectionManager("updateCollection"),t(this).trigger("collection_add",r)},deleteCollectionItem:function(e){t(e).remove(),t(this).trigger("collection_delete",e)},newAddButton:function(){var e,o=t(this).data("adderPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("add"),e.addClass("collection_adder"),e},newDeleteButton:function(){var e,o=t(this).parent().data("deleterPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("delete"),e.addClass("collection_deleter"),e},provideAddButton:function(){if(0==t(this).find("> .collection_adder").length){var e=this;addButton=t(this).collectionManager("newAddButton").appendTo(this).click(function(){t(e).collectionManager("addCollectionItem")})}},provideDeleteButton:function(){if(0==t(this).find("> .collection_deleter").length){var e=this;deleteButton=t(this).collectionManager("newDeleteButton").appendTo(this).click(function(){t(e).parent().collectionManager("deleteCollectionItem",e)})}},updateCollection:function(){t(this).find('[data-prototype], [data-allow-remove="true"]').each(function(){if(t(this).collectionManager("isAddAllowed")&&t(this).collectionManager("provideAddButton"),t(this).collectionManager("isDeleteAllowed")){var e=t(this).collectionManager("childSelector");t(this).find(e).each(function(){t(this).collectionManager("provideDeleteButton")})}})}};t(document).ready(function(){t(this).collectionManager("updateCollection")})}(jQuery);