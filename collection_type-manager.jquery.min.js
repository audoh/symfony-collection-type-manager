!function(t){t.fn.collectionManager=function(t,o){return e[t].apply(this,o)};var e={isDeleteAllowed:function(){return t(this).data("allowDelete")!==!1},isAddAllowed:function(){return void 0!==t(this).data("prototype")&&t(this).data("allowAdd")!==!1},childTag:function(){return void 0!==t(this).data("childTag")?t(this).data("childTag"):"div"},addCollectionItem:function(o){var n=t(o).data("prototype"),l=e.resolvePrototypeName(n),i=t(o).collectionManager("childTag"),a=t(o).children(i).length,d=new RegExp(l,"g"),n=n.replace(d,a),c=t("<"+i+"/>").html(t(n).html());c.insertBefore(t(this)),t(o).trigger("collection_add"),t(o).collectionManager("isDeleteAllowed")&&t(c).collectionManager("provideDeleteButton"),t(c).collectionManager("updateCollection")},resolvePrototypeName:function(t){return t.match(/__[^_\s]*__/)},newAddButton:function(){var e,o=t(this).data("adderPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("add"),e.addClass("collection_add"),e},newDeleteButton:function(){var e,o=t(this).parent().data("deleterPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("delete"),e.addClass("collection_delete"),e},provideAddButton:function(){if(0==t(this).find("> .collection_add").length){var e=this;addButton=t(this).collectionManager("newAddButton").appendTo(this).click(function(){t(this).collectionManager("addCollectionItem",e)})}},provideDeleteButton:function(){if(0==t(this).find("> .collection_delete").length){var e=this;deleteButton=t(this).collectionManager("newDeleteButton").appendTo(this).click(function(){t(e).remove()})}},updateCollection:function(e){t(this).find('[data-prototype], [data-allow-remove="true"]').each(function(){t(this).collectionManager("isAddAllowed")&&t(this).collectionManager("provideAddButton"),t(this).collectionManager("isDeleteAllowed")&&(void 0===e&&(e="> "+t(parent).collectionManager("childTag")),t(this).find(e).each(function(){t(this).collectionManager("provideDeleteButton")}))})}};t(document).ready(function(){t(this).collectionManager("updateCollection")})}(jQuery);