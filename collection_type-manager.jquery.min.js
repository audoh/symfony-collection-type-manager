!function(t){t.fn.collectionManager=function(o,n){return void 0!==(ret=e[o].apply(this,n))?ret:t(this)};var e={isDeleteAllowed:function(){return t(this).data("allowDelete")!==!1},isAddAllowed:function(){return void 0!==t(this).data("prototype")&&t(this).data("allowAdd")!==!1},childSelector:function(){return void 0!==t(this).data("itemSelector")?t(this).data("itemSelector"):"div"},prototypeName:function(){return void 0!==t(this).data("prototypeName")?t(this).data("prototypeName"):"__name__"},addCollectionItem:function(e){var o=t(e).data("prototype"),n=t(e).collectionManager("prototypeName"),i=t(e).collectionManager("childSelector"),l=t(e).children(i).length,a=new RegExp(n,"g"),d=new RegExp(n+"label__","g"),o=o.replace(d,l).replace(a,l),c=t(o).insertBefore(t(this));t(e).collectionManager("isDeleteAllowed")&&t(c).collectionManager("provideDeleteButton"),t(c).collectionManager("updateCollection"),t(e).trigger("collection_add")},newAddButton:function(){var e,o=t(this).data("adderPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("add"),e.addClass("collection_adder"),e},newDeleteButton:function(){var e,o=t(this).parent().data("deleterPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("delete"),e.addClass("collection_deleter"),e},provideAddButton:function(){if(0==t(this).find("> .collection_adder").length){var e=this;addButton=t(this).collectionManager("newAddButton").appendTo(this).click(function(){t(this).collectionManager("addCollectionItem",e)})}},provideDeleteButton:function(){if(0==t(this).find("> .collection_deleter").length){var e=this;deleteButton=t(this).collectionManager("newDeleteButton").appendTo(this).click(function(){t(e).remove(),t(e).parent().trigger("collection_delete")})}},updateCollection:function(){t(this).find('[data-prototype], [data-allow-remove="true"]').each(function(){if(t(this).collectionManager("isAddAllowed")&&t(this).collectionManager("provideAddButton"),t(this).collectionManager("isDeleteAllowed")){var e=t(this).collectionManager("childSelector");t(this).find("> "+e).each(function(){t(this).collectionManager("provideDeleteButton")})}})}};t(document).ready(function(){t(this).collectionManager("updateCollection")})}(jQuery);