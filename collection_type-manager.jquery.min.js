!function(t){t.fn.collectionManager=function(t,o){return e[t].apply(this,o)};var e={isDeleteAllowed:function(){return t(this).data("allowDelete")!==!1},isAddAllowed:function(){return void 0!==t(this).data("prototype")&&t(this).data("allowAdd")!==!1},childSelector:function(){return void 0!==t(this).data("childSelector")?t(this).data("childSelector"):"div"},addCollectionItem:function(o){var n=t(o).data("prototype"),l=e.resolvePrototypeName(n),i=t(o).collectionManager("childSelector"),a=t(o).children(i).length,c=new RegExp(l,"g"),n=n.replace(c,a),d=t(n).insertBefore(t(this));t(o).collectionManager("isDeleteAllowed")&&t(d).collectionManager("provideDeleteButton"),t(d).collectionManager("updateCollection"),t(o).trigger("collection_add")},resolvePrototypeName:function(t){return t.match(/__[^_\s]*__/)},newAddButton:function(){var e,o=t(this).data("adderPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("add"),e.addClass("collection_add"),e},newDeleteButton:function(){var e,o=t(this).parent().data("deleterPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("delete"),e.addClass("collection_delete"),e},provideAddButton:function(){if(0==t(this).find("> .collection_add").length){var e=this;addButton=t(this).collectionManager("newAddButton").appendTo(this).click(function(){t(this).collectionManager("addCollectionItem",e)})}},provideDeleteButton:function(){if(0==t(this).find("> .collection_delete").length){var e=this;deleteButton=t(this).collectionManager("newDeleteButton").appendTo(this).click(function(){t(e).remove(),t(e).parent().trigger("collection_delete")})}},updateCollection:function(){t(this).find('[data-prototype], [data-allow-remove="true"]').each(function(){if(t(this).collectionManager("isAddAllowed")&&t(this).collectionManager("provideAddButton"),t(this).collectionManager("isDeleteAllowed")){var e=t(this).collectionManager("childSelector");t(this).find("> "+e).each(function(){t(this).collectionManager("provideDeleteButton")})}})}};t(document).ready(function(){t(this).collectionManager("updateCollection")})}(jQuery);