!function(t){t.fn.collectionManager=function(o,n){return void 0!==(ret=e[o].apply(this,n))?ret:t(this)};var e={isDeleteAllowed:function(){return t(this).data("allowDelete")!==!1},isAddAllowed:function(){return void 0!==t(this).data("prototype")&&t(this).data("allowAdd")!==!1},isDeleteNewAllowed:function(){return t(this).data("allowDeleteNew")!==!1},childSelector:function(){return void 0!==t(this).data("itemSelector")?t(this).data("itemSelector"):"div"},prototypeName:function(){return void 0!==t(this).data("prototypeName")?t(this).data("prototypeName"):"__name__"},addCollectionItem:function(){var e=t(this).data("prototype"),o=t(this).collectionManager("prototypeName"),n=t(this).collectionManager("childSelector"),l=t(this).children(n),i=l.length,a=new RegExp(o,"g"),c=new RegExp(o+"label__","g"),e=e.replace(c,i).replace(a,i),d=t(e).insertAfter(l.last());t(this).collectionManager("isDeleteNewAllowed")&&t(d).collectionManager("provideDeleteButton"),t(d).collectionManager("updateCollection"),t(this).trigger("collection_add")},newAddButton:function(){var e,o=t(this).data("adderPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("add"),e.addClass("collection_adder"),e},newDeleteButton:function(){var e,o=t(this).parent().data("deleterPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("delete"),e.addClass("collection_deleter"),e},addButtonClick:function(){t(t(this).parent()).collectionManager("addCollectionItem")},deleteButtonClick:function(){var e=t(this).parent(),o=t(e).parent();t(e).remove(),t(o).trigger("collection_delete")},provideAddButton:function(){0==t(this).find("> .collection_adder").length&&(addButton=t(this).collectionManager("newAddButton").appendTo(this).click(function(){t(this).collectionManager("addButtonClick")}))},provideDeleteButton:function(){0==t(this).find("> .collection_deleter").length&&(deleteButton=t(this).collectionManager("newDeleteButton").appendTo(this).click(function(){t(this).collectionManager("deleteButtonClick")}))},updateCollection:function(){t(this).find('[data-prototype], [data-allow-remove="true"]').each(function(){if(t(this).collectionManager("isAddAllowed")&&t(this).collectionManager("provideAddButton"),t(this).collectionManager("isDeleteAllowed")){var e=t(this).collectionManager("childSelector");t(this).find("> "+e).each(function(){t(this).collectionManager("provideDeleteButton")})}})}};t(document).ready(function(){t(this).collectionManager("updateCollection")})}(jQuery);