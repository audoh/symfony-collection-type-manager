!function(t){t.fn.collectionManager=function(t,o){return e[t].apply(this,o)};var e={isDeleteAllowed:function(){return t(this).data("allowDelete")!==!1},isAddAllowed:function(){return void 0!==t(this).data("prototype")&&t(this).data("allowAdd")!==!1},childSelector:function(){return void 0!==t(this).data("itemSelector")?t(this).data("itemSelector"):"div"},prototypeName:function(){return void 0!==t(this).data("prototypeName")?t(this).data("prototypeName"):"__name__"},addCollectionItem:function(e){var o=t(e).data("prototype"),n=t(e).collectionManager("prototypeName"),l=t(e).collectionManager("childSelector"),i=t(e).children(l).length,a=new RegExp(n,"g"),d=new RegExp(n+"label__","g"),o=o.replace(d,i).replace(a,i),c=t(o).insertBefore(t(this));t(e).collectionManager("isDeleteAllowed")&&t(c).collectionManager("provideDeleteButton"),t(c).collectionManager("updateCollection"),t(e).trigger("collection_add")},newAddButton:function(){var e,o=t(this).data("adderPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("add"),e.addClass("collection_add"),e},newDeleteButton:function(){var e,o=t(this).parent().data("deleterPrototype");return e=void 0!==o?t(o):t("<button/>").attr("type","button").html("delete"),e.addClass("collection_delete"),e},provideAddButton:function(){if(0==t(this).find("> .collection_add").length){var e=this;addButton=t(this).collectionManager("newAddButton").appendTo(this).click(function(){t(this).collectionManager("addCollectionItem",e)})}},provideDeleteButton:function(){if(0==t(this).find("> .collection_delete").length){var e=this;deleteButton=t(this).collectionManager("newDeleteButton").appendTo(this).click(function(){t(e).remove(),t(e).parent().trigger("collection_delete")})}},updateCollection:function(){t(this).find('[data-prototype], [data-allow-remove="true"]').each(function(){if(t(this).collectionManager("isAddAllowed")&&t(this).collectionManager("provideAddButton"),t(this).collectionManager("isDeleteAllowed")){var e=t(this).collectionManager("childSelector");t(this).find("> "+e).each(function(){t(this).collectionManager("provideDeleteButton")})}})}};t(document).ready(function(){t(this).collectionManager("updateCollection")})}(jQuery);